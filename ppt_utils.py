from pptx import Presentation
from pptx.util import Inches, Pt
import os

def create_ppt(data, filename="generated_presentation.pptx"):
    """
    Creates a PowerPoint presentation from structured data.
    
    Args:
        data (dict): Dictionary usually containing 'title' and 'slides' list.
                     Each slide in 'slides' should have 'heading' and 'bullet_points'.
        filename (str): Name of the output file.
        
    Returns:
        str: Absolute path to the generated PPTX file.
    """
    prs = Presentation()

    # 1. Title Slide
    title_slide_layout = prs.slide_layouts[0]
    slide = prs.slides.add_slide(title_slide_layout)
    title = slide.shapes.title
    subtitle = slide.placeholders[1]

    title.text = data.get("title", "Untitled Presentation")
    subtitle.text = "Generated by Gemini"

    # 2. Content Slides
    bullet_slide_layout = prs.slide_layouts[1]

    if "slides" in data:
        for slide_data in data["slides"]:
            slide = prs.slides.add_slide(bullet_slide_layout)
            shapes = slide.shapes

            # Title
            title_shape = shapes.title
            title_shape.text = slide_data.get("heading", "No Title")

            # Body (Bullet points)
            body_shape = shapes.placeholders[1]
            tf = body_shape.text_frame
            tf.word_wrap = True

            bullet_points = slide_data.get("bullet_points", [])
            if isinstance(bullet_points, list):
                for i, point in enumerate(bullet_points):
                    if i == 0:
                        p = tf.text = point # First line
                    else:
                        p = tf.add_paragraph()
                        p.text = point
                        p.level = 0
            else:
                 tf.text = str(bullet_points)

    # Ensure output directory exists (optional, mostly saving to current dir)
    output_path = os.path.abspath(filename)
    prs.save(output_path)
    return output_path
